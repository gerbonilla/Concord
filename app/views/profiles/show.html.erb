<h2>Welcome <%= @profile.first_name %></h2>

<%= link_to "Your Account", profile_account_path(@profile, @profile.accounts[0]) %>
<br>
<%= link_to "Your Card", profile_card_path(@profile, @profile.accounts[0].card) %>
<br>
<%= link_to "Your Transactions", profile_transactions_path(@profile) %>
<br>
<p>You have <%= @accounts.size %> accounts linked</p>

<div class="container">
  <div class="row">
    <div class="col-xs-3">
      <!-- Leave blank intentionally -->
    </div>
    <% @accounts.each do |account| %>
    <div class="col-xs-<%= account[:portfolios].count %>">
      <p><%= account[:account].brokerage_name %></p>
    </div>
    <% end %>
  </div>
  <div class="row">
    <div class="col-xs-3">
      <p>Asset Class</p>
      <% @positions.each do |position, value| %>
      <p><%= position %></p>
      <% end %>
    </div>
    <% @accounts.each do |acct| %>
    <% acct[:portfolios].each do |portfolio| %>
    <div class="col-xs-1">
    <p><%= portfolio[:portfolio].portfolio_name %></p>
    <% total = 0 %>
    <% @positions.each do |position2, value2| %>
    <% if portfolio[:asset_class][position2].nil? %>
    <p><%= money_without_cents_and_with_symbol Money.new(0, "USD") %></p>
    <% else %>
    <p><%= money_without_cents_and_with_symbol Money.new(portfolio[:asset_class][position2] * 100, "USD") %></p>
    <% total += portfolio[:asset_class][position2] %>
    <% end %>
    <% end %>
    <p><%= money_without_cents_and_with_symbol Money.new(total * 100, "USD") %></p>
    </div>
    <% end %>
    <% end %>
    <div class="col-xs-1">
      <p>Total</p>
      <% total = 0 %>
      <% @positions.each do |position3, value3| %>
        <p><%= money_without_cents_and_with_symbol Money.new(value3 * 100, "USD") %></p>
        <% total += value3 %>
      <% end %>
      <p><%= money_without_cents_and_with_symbol Money.new(total * 100, "USD") %></p>
    </div>
  </div>
</div>


<div id="quovo-widget"></div>
<!-- {token} is generated by a backend process every time the page is loaded. -->
<script
type="text/javascript"
src="https://connect.quovo.com/connect.js"
data-connect-id="quovo-widget"
data-token=<%= @token %>>
</script>
